name: Deploy via SSH (with Password)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install sshpass
        run: sudo apt-get update && sudo apt-get install -y sshpass

      - name: Deploy code to server
        run: |
          sshpass -p "${{ secrets.SSH_PASSWORD }}" ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} << 'EOF'
            cd /var/www
            if [ ! -d "BMFWebsite/.git" ]; then
              mkdir BMFWebsite
              cd BMFWebsite
              echo "ðŸ”§ Directory doesn't exist or not a Git repo. Cloning fresh..."
              git clone git@github.com:Xvantage-Infotech/bmf-website.git BMFWebsite
            else
              echo "ðŸ”„ Directory exists. Pulling latest changes..."
              cd BMFWebsite
              git pull origin main
              pm2 restart bmf
            fi
          EOF
